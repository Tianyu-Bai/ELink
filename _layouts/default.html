<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
    <title>{{ page.title }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono&display=swap" rel="stylesheet">
    
    <style>
      /* --- 基础样式保持不变 --- */
      body { 
        margin: 0; padding: 0; color: #475569; 
        font-family: 'Inter', -apple-system, sans-serif; 
        line-height: 1.6; overflow-x: hidden; 
        background: #fdf4ff;
        cursor: none;
        -webkit-tap-highlight-color: transparent; /* 移除 iPhone 点击蓝框 */
      }

      /* --- 1. 机器人：移动端适配版 --- */
      #bot-container {
        position: fixed; top: 20px; right: 20px; /* 手机端像灵岛一样待在右上角 */
        width: 80px; height: 50px; z-index: 1000; 
        cursor: pointer;
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      
      @media (min-width: 769px) {
        #bot-container { position: absolute; top: -45px; left: 50%; transform: translateX(-50%); width: 120px; height: 70px; }
      }

      .bot-head { 
        width: 100%; height: 100%; background: #ffffff; border: 2px solid #e9d5ff; 
        border-radius: 20px; display: flex; justify-content: center; align-items: center; gap: 8px; 
        box-shadow: 0 10px 25px rgba(168, 85, 247, 0.1);
        animation: float-bot 3s ease-in-out infinite;
      }
      
      .bot-eye { width: 20px; height: 20px; background: #f3e8ff; border-radius: 50%; position: relative; overflow: hidden; border: 1px solid #d8b4fe; }
      .bot-pupil { 
        width: 10px; height: 10px; background: #7e22ce; border-radius: 50%; 
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        transition: all 0.2s ease-out;
      }

      /* --- 2. 交互状态：电感蓝 --- */
      body.active-state .bot-pupil { 
        background: radial-gradient(circle at 30% 30%, #60a5fa, #2563eb);
        box-shadow: 0 0 15px #3b82f6;
      }
      body.active-state .bot-head { border-color: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }

      /* --- 3. 容器：iOS 玻璃拟态 --- */
      .container { 
        position: relative; padding: 40px 25px; margin: 100px 15px 40px;
        background: rgba(255, 255, 255, 0.7); 
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 20px 40px rgba(0,0,0,0.05);
        transform-style: preserve-3d;
      }

      /* --- 4. 进度条与光标略过 --- */
      #progress-bar { position: fixed; top: 0; left: 0; height: 3px; background: linear-gradient(90deg, #a855f7, #3b82f6); width: 0%; z-index: 9999; }
      .cursor-dot, .cursor-outline { position: fixed; pointer-events: none; z-index: 99999; transform: translate(-50%, -50%); border-radius: 50%; }
      .cursor-dot { width: 6px; height: 6px; background: #a855f7; }
      .cursor-outline { width: 30px; height: 30px; border: 1px solid rgba(168, 85, 247, 0.4); transition: width 0.3s, height 0.3s; }

      @media (max-width: 768px) { .cursor-dot, .cursor-outline { display: none; } }

      /* 动画略过，保持你原有的... */
      @keyframes float-bot { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    </style>
  </head>

  <body>
    <div class="cursor-dot"></div>
    <div class="cursor-outline"></div>
    <div id="progress-bar"></div>
    <div id="vanta-bg" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1;"></div>

    <div class="layout-wrapper">
      <div id="bot-container">
        <div class="bot-head">
          <div class="bot-eye"><div class="bot-pupil"></div></div>
          <div class="bot-eye"><div class="bot-pupil"></div></div>
        </div>
      </div>

      <div class="container">
        <h1>{{ page.title }}</h1>
        <div class="nav-badges">
          </div>
        <section id="main_content">{{ content }}</section>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>

    <script>
      // 1. 初始化背景
      let vantaEffect = VANTA.NET({
        el: "#vanta-bg",
        mouseControls: true, touchControls: true,
        color: 0xa855f7, backgroundColor: 0xfdf4ff,
        points: 12.0, maxDistance: 20.0, spacing: 16.0
      });

      // 2. 核心交互逻辑
      document.addEventListener("DOMContentLoaded", () => {
        const bot = document.getElementById('bot-container');
        const pupils = document.querySelectorAll('.bot-pupil');
        const body = document.body;

        // 鼠标跟随（桌面端）
        window.addEventListener('mousemove', (e) => {
          updateEyes(e.clientX, e.clientY);
          // 自定义光标
          document.querySelector('.cursor-dot').style.left = e.clientX + 'px';
          document.querySelector('.cursor-dot').style.top = e.clientY + 'px';
          document.querySelector('.cursor-outline').animate({
            left: e.clientX + 'px', top: e.clientY + 'px'
          }, { duration: 400, fill: "forwards" });
        });

        function updateEyes(x, y) {
          pupils.forEach(pupil => {
            const rect = pupil.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const angle = Math.atan2(y - centerY, x - centerX);
            const dist = Math.min(5, Math.hypot(x - centerX, y - centerY) / 20);
            pupil.style.transform = `translate(calc(-50% + ${Math.cos(angle) * dist}px), calc(-50% + ${Math.sin(angle) * dist}px))`;
          });
        }

        // 3. iPhone 特有的陀螺仪控制 (Gyroscope)
        function initGyro() {
          if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
              .then(permissionState => {
                if (permissionState === 'granted') {
                  window.addEventListener('deviceorientation', (event) => {
                    // event.gamma 是左右倾斜 (-90 到 90)
                    // event.beta 是前后倾斜 (-180 到 180)
                    const x = event.gamma * 2 + window.innerWidth / 2;
                    const y = event.beta * 2 + window.innerHeight / 2;
                    updateEyes(x, y);
                    
                    // 背景随手机倾斜微动
                    if(vantaEffect) {
                      vantaEffect.setOptions({
                        mouseControls: false,
                        gyroControls: true
                      });
                    }
                  });
                }
              });
          }
        }

        // 4. 移动端交互：点击 Badge 触发“电感蓝”
        const badges = document.querySelectorAll('.nav-badges a');
        badges.forEach(b => {
          b.addEventListener('touchstart', () => {
            body.classList.add('active-state');
            vantaEffect.setOptions({ color: 0x3b82f6 });
            initGyro(); // iPhone 必须在点击事件里请求授权
          });
          b.addEventListener('touchend', () => {
            setTimeout(() => {
              body.classList.remove('active-state');
              vantaEffect.setOptions({ color: 0xa855f7 });
            }, 1000);
          });
        });

        // 机器人点击特效
        bot.addEventListener('click', () => {
          bot.style.transform = 'scale(0.8) rotate(15deg)';
          setTimeout(() => bot.style.transform = '', 300);
        });

        // 滚动进度
        window.addEventListener('scroll', () => {
          const scrolled = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
          document.getElementById("progress-bar").style.width = scrolled + "%";
        });
      });
    </script>
  </body>
</html>
